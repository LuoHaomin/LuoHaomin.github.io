
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  
  
  <meta name="generator" content="Hexo 8.0.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>BevyBook：input基础 - LHM's Blog</title>

  
    <meta name="description" content="input基础Bevy Input 基础教程本教程基于Bevy官方示例，按主题组织，提供易于理解的输入系统使用参考。 键盘输入基础键盘输入示例文件: keyboard_input.rs 最基本的键盘输入处理： 123456789101112131415161718192021222324252627use bevy::prelude::*;fn main() &#123;    App::new(">
<meta property="og:type" content="website">
<meta property="og:title" content="input基础">
<meta property="og:url" content="https://luohaomin.github.io/Luo-Haomin/wiki/BevyBook/Input/input%E5%9F%BA%E7%A1%80/">
<meta property="og:site_name" content="LHM&#39;s Blog">
<meta property="og:description" content="input基础Bevy Input 基础教程本教程基于Bevy官方示例，按主题组织，提供易于理解的输入系统使用参考。 键盘输入基础键盘输入示例文件: keyboard_input.rs 最基本的键盘输入处理： 123456789101112131415161718192021222324252627use bevy::prelude::*;fn main() &#123;    App::new(">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="solar:star-ring-bold-duotone">
<meta property="article:published_time" content="2025-11-07T15:45:38.315Z">
<meta property="article:modified_time" content="2025-11-07T15:45:38.315Z">
<meta property="article:author" content="LuoHaomin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="solar:star-ring-bold-duotone">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/Luo-Haomin/atom.xml" title="LHM's Blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/Luo-Haomin/css/main.css?v=1.33.1">


  
    <link rel="shortcut icon" href="/Luo-Haomin/image/Logo.jpg">
  

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Website","@id":"https://luohaomin.github.io/Luo-Haomin/wiki/BevyBook/Input/input%E5%9F%BA%E7%A1%80/","author":{"@type":"Person","name":"LuoHaomin","sameAs":[],"image":"solar:star-ring-bold-duotone"},"name":"input基础","description":"input基础Bevy Input 基础教程本教程基于Bevy官方示例，按主题组织，提供易于理解的输入系统使用参考。\n键盘输入基础键盘输入示例文件: keyboard_input.rs\n最基本的键盘输入处理：\n123456789101112131415161718192021222324252627use bevy::prelude::*;fn main() &#123;    App::n...","url":"https://luohaomin.github.io/Luo-Haomin/wiki/BevyBook/Input/input%E5%9F%BA%E7%A1%80/"}</script>
  
</head>
<body>



<div class="l_body content" id="start" layout="page" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><div class="icon"><img no-lazy class="icon" src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2779789.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></div><a class="title" href="/Luo-Haomin/wiki/BevyBook/README"><div class="main">BevyBook</div><div class="sub cap">从零开始掌握 Bevy 游戏开发</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item" title="博客" href="/Luo-Haomin/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item active" title="文档" href="/Luo-Haomin/wiki/" style="color:#00FF7F"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 4.69434V18.6943C4 20.3512 5.34315 21.6943 7 21.6943H17C18.6569 21.6943 20 20.3512 20 18.6943V8.69434C20 7.03748 18.6569 5.69434 17 5.69434H5C4.44772 5.69434 4 5.24662 4 4.69434ZM7.25 11.6943C7.25 11.2801 7.58579 10.9443 8 10.9443H16C16.4142 10.9443 16.75 11.2801 16.75 11.6943C16.75 12.1085 16.4142 12.4443 16 12.4443H8C7.58579 12.4443 7.25 12.1085 7.25 11.6943ZM7.25 15.1943C7.25 14.7801 7.58579 14.4443 8 14.4443H13.5C13.9142 14.4443 14.25 14.7801 14.25 15.1943C14.25 15.6085 13.9142 15.9443 13.5 15.9443H8C7.58579 15.9443 7.25 15.6085 7.25 15.1943Z" fill="currentColor"></path><path opacity="0.5" d="M18 4.00038V5.86504C17.6872 5.75449 17.3506 5.69434 17 5.69434H5C4.44772 5.69434 4 5.24662 4 4.69434V4.62329C4 4.09027 4.39193 3.63837 4.91959 3.56299L15.7172 2.02048C16.922 1.84835 18 2.78328 18 4.00038Z" fill="currentColor"></path></svg></a><a class="nav-item" title="笔记" href="/Luo-Haomin/notebooks/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/Luo-Haomin/about/" style="color:#FF1493"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.2915 4.78559C4.78799 5.52306 3.03694 7.79713 3.00057 10.4163C3 10.4574 3 10.5036 3 10.596V12.9192C3.10197 12.9191 3.2056 12.9398 3.30479 12.9835C8.84065 15.4273 15.1597 15.4273 20.6956 12.9835C20.7947 12.9398 20.8982 12.9191 21 12.9192V10.596C21 10.5036 21 10.4574 20.9994 10.4163C20.9631 7.79714 19.212 5.52309 16.7085 4.7856C16.4308 4.69458 15.5892 4.53187 15.2032 4.46189C13.0832 4.10174 10.9169 4.10173 8.79689 4.46188C8.39226 4.53846 7.52471 4.71042 7.2915 4.78559ZM10 11.9259C9.58579 11.9259 9.25 12.2594 9.25 12.6708C9.25 13.0823 9.58579 13.4158 10 13.4158H14C14.4142 13.4158 14.75 13.0823 14.75 12.6708C14.75 12.2594 14.4142 11.9259 14 11.9259H10Z" fill="currentColor"></path><path opacity="0.5" d="M8.87313 3.99175C9.17888 3.11649 10.0165 2.48989 10.9995 2.48989H12.9995C13.9826 2.48989 14.8202 3.11649 15.1259 3.99175C15.1714 4.12188 15.1935 4.27205 15.2027 4.46183C15.5887 4.53181 16.4303 4.69453 16.7081 4.78555V4.72453C16.7081 4.38601 16.6965 3.94261 16.5431 3.50336C16.0344 2.04714 14.641 1 12.9995 1H10.9995C9.35804 1 7.96471 2.04714 7.45601 3.50336C7.30256 3.94261 7.29102 4.38601 7.29102 4.72453V4.78553C7.52422 4.71037 8.39178 4.53841 8.7964 4.46182C8.80554 4.27205 8.82767 4.12188 8.87313 3.99175Z" fill="currentColor"></path><path opacity="0.5" d="M21 14.4767C20.1 14.8586 19.1814 15.1807 18.2502 15.443V16.6438C18.2502 17.0552 17.9144 17.3888 17.5002 17.3888C17.086 17.3888 16.7502 17.0552 16.7502 16.6438V15.8117C12.1726 16.7753 7.36827 16.3302 3 14.4766V16.0229C3 18.1266 4.47101 19.948 6.53853 20.4043C10.1356 21.1983 13.8644 21.1983 17.4615 20.4043C19.529 19.948 21 18.1266 21 16.0229V14.4767Z" fill="currentColor"></path></svg></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" data-filter="/wiki/BevyBook/" placeholder="在 BevyBook 中搜索..."></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<widget class="widget-wrapper doc-tree post-list"><div class="widget-header dis-select"><span class="name">基础</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/README/#start"><span class="toc-text">Bevy 完整教程</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/INDEX/"><span class="toc-text">Bevy 教程完整索引</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/LEARNING_PATH/"><span class="toc-text">学习路径指南</span></a></div><div class="widget-header dis-select"><span class="name">Foundation（基础）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Foundation/README/"><span class="toc-text">Foundation（基础）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Foundation/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"><span class="toc-text">快速入门</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Foundation/Bevy%E2%80%94%E2%80%94Rust%E6%A1%86%E6%9E%B6/"><span class="toc-text">Bevy——Rust框架</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Foundation/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/"><span class="toc-text">游戏引擎基础</span></a></div><div class="widget-header dis-select"><span class="name">ECS（实体组件系统）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/README/"><span class="toc-text">ECS（实体组件系统）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E6%A1%86%E6%9E%B6%EF%BC%88ECS%EF%BC%89/"><span class="toc-text">核心编程框架（ECS）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E7%BB%84%E4%BB%B6%EF%BC%88Components%EF%BC%89/"><span class="toc-text">组件（Components）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E5%AE%9E%E4%BD%93%EF%BC%88Entities%EF%BC%89/"><span class="toc-text">实体（Entities）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E7%B3%BB%E7%BB%9F%EF%BC%88Systems%EF%BC%89/"><span class="toc-text">系统（Systems）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E6%9F%A5%E8%AF%A2%EF%BC%88Queries%EF%BC%89/"><span class="toc-text">查询（Queries）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E8%B5%84%E6%BA%90%EF%BC%88Resources%EF%BC%89/"><span class="toc-text">资源（Resources）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E5%91%BD%E4%BB%A4%EF%BC%88Commands%EF%BC%89/"><span class="toc-text">命令（Commands）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E6%97%B6%E9%97%B4%E7%B3%BB%E7%BB%9F%EF%BC%88Time%EF%BC%89/"><span class="toc-text">时间系统（Time）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%EF%BC%88State%EF%BC%89/"><span class="toc-text">状态管理（State）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/%E7%B3%BB%E7%BB%9F%E8%B0%83%E5%BA%A6%EF%BC%88Schedule%E4%B8%8EApp%EF%BC%89/"><span class="toc-text">系统调度（Schedule & App）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/ECS/ECS%E8%BF%9B%E9%98%B6/"><span class="toc-text">ECS 进阶</span></a></div><div class="widget-header dis-select"><span class="name">Assets（资源管理）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Assets/README/"><span class="toc-text">Assets（资源管理）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Assets/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/"><span class="toc-text">资源管理</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Assets/%E5%9C%BA%E6%99%AF%E7%B3%BB%E7%BB%9F%EF%BC%88Scene%EF%BC%89/"><span class="toc-text">场景系统（Scene）</span></a></div><div class="widget-header dis-select"><span class="name">Input（输入处理）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Input/README/"><span class="toc-text">Input（输入处理）</span></a><a class="link active" href="/Luo-Haomin/wiki/BevyBook/Input/input%E5%9F%BA%E7%A1%80/"><span class="toc-text">input基础</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Input/%E8%BE%93%E5%85%A5%E5%A4%84%E7%90%86/"><span class="toc-text">输入处理</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Input/%E6%8B%BE%E5%8F%96%E7%B3%BB%E7%BB%9F%EF%BC%88Picking%EF%BC%89/"><span class="toc-text">拾取系统（Picking）</span></a></div><div class="widget-header dis-select"><span class="name">Animation（动画）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Animation/README/"><span class="toc-text">Animation（动画系统）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Animation/%E5%8A%A8%E7%94%BB%E5%9F%BA%E7%A1%80/"><span class="toc-text">动画基础</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Animation/%E5%8A%A8%E7%94%BB%E8%BF%9B%E9%98%B6/"><span class="toc-text">动画进阶</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Animation/UI%E5%8A%A8%E7%94%BB/"><span class="toc-text">UI 动画</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Animation/%E5%8F%98%E5%BD%A2%E7%9B%AE%E6%A0%87/"><span class="toc-text">变形目标（Morph Targets）</span></a></div><div class="widget-header dis-select"><span class="name">2D Graphics（2D图形）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/2D_Graphics/README/"><span class="toc-text">2D Graphics（2D 图形）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/2D_Graphics/2D%E5%9F%BA%E7%A1%80/"><span class="toc-text">2D 基础</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/2D_Graphics/2D%E5%BC%80%E5%8F%91/"><span class="toc-text">2D开发</span></a></div><div class="widget-header dis-select"><span class="name">3D Graphics（3D图形）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/3D_Graphics/README/"><span class="toc-text">3D Graphics（3D 图形）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/3D_Graphics/3D%E5%BC%80%E5%8F%91/"><span class="toc-text">3D开发</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/3D_Graphics/%E7%9B%B8%E6%9C%BA%E7%B3%BB%E7%BB%9F%EF%BC%88Camera%EF%BC%89/"><span class="toc-text">相机系统（Camera）</span></a></div><div class="widget-header dis-select"><span class="name">UI & Audio（界面与音频）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/README/"><span class="toc-text">UI & Audio & Window（界面、音频与窗口）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/%E7%AA%97%E5%8F%A3/"><span class="toc-text">窗口管理</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/UI/"><span class="toc-text">用户界面（UI）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/%E9%9F%B3%E9%A2%91/"><span class="toc-text">音频系统</span></a></div><div class="widget-header dis-select"><span class="name">Architecture（架构设计）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Architecture/README/"><span class="toc-text">Architecture（架构设计）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Architecture/%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87/"><span class="toc-text">代码组织</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Architecture/%E9%80%BB%E8%BE%91-%E6%B8%B2%E6%9F%93%E5%88%86%E7%A6%BB/"><span class="toc-text">逻辑-渲染分离</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Architecture/plugin%E7%B3%BB%E7%BB%9F/"><span class="toc-text">插件系统</span></a></div><div class="widget-header dis-select"><span class="name">Advanced（高级主题）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Advanced/README/"><span class="toc-text">Advanced（高级主题）</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Advanced/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><span class="toc-text">性能优化</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Advanced/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B8%B2%E6%9F%93/"><span class="toc-text">自定义渲染</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Advanced/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="toc-text">网络编程</span></a><a class="link" href="/Luo-Haomin/wiki/BevyBook/Advanced/%E6%8B%86%E8%A7%A3%E5%AD%A6%E4%B9%A0/"><span class="toc-text">拆解学习</span></a></div><div class="widget-header dis-select"><span class="name">Examples（示例项目）</span></div><div class="widget-body fs14"><a class="link" href="/Luo-Haomin/wiki/BevyBook/Examples/README/"><span class="toc-text">Examples（示例项目）</span></a></div></widget>

<widget class="widget-wrapper recent post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/%E9%9F%B3%E9%A2%91/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>音频系统</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/%E7%AA%97%E5%8F%A3/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>窗口管理</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/UI/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>用户界面（UI）</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/UI_Audio_Window/README/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>UI & Audio & Window（界面、音频与窗口）</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Input/%E8%BE%93%E5%85%A5%E5%A4%84%E7%90%86/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>输入处理</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Input/%E6%8B%BE%E5%8F%96%E7%B3%BB%E7%BB%9F%EF%BC%88Picking%EF%BC%89/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>拾取系统（Picking）</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Input/README/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>Input（输入处理）</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Foundation/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>游戏引擎基础</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Foundation/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>快速入门</span></a><a class="item title" href="/Luo-Haomin/wiki/BevyBook/Foundation/README/"><span class="title"><strong>BevyBook</strong><span class="dot"></span>Foundation（基础）</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/Luo-Haomin/Luo-Haomin/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/Luo-Haomin/wiki/">文档</a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/Luo-Haomin/wiki/BevyBook/README/">BevyBook</a></div>
<div class="flex-row" id="post-meta"><span class="text created">更新于：<time datetime="2025-11-07T15:45:38.315Z">2025-11-07</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>input基础</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="input基础"><a href="#input基础" class="headerlink" title="input基础"></a>input基础</h1><h1 id="Bevy-Input-基础教程"><a href="#Bevy-Input-基础教程" class="headerlink" title="Bevy Input 基础教程"></a>Bevy Input 基础教程</h1><p>本教程基于Bevy官方示例，按主题组织，提供易于理解的输入系统使用参考。</p>
<h2 id="键盘输入"><a href="#键盘输入" class="headerlink" title="键盘输入"></a>键盘输入</h2><h3 id="基础键盘输入"><a href="#基础键盘输入" class="headerlink" title="基础键盘输入"></a>基础键盘输入</h3><p><strong>示例文件</strong>: <code>keyboard_input.rs</code></p>
<p>最基本的键盘输入处理：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, keyboard_input_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 处理键盘输入的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">keyboard_input_system</span>(keyboard_input: Res&lt;ButtonInput&lt;KeyCode&gt;&gt;) &#123;</span><br><span class="line">    <span class="comment">// 检查按键是否正在被按下</span></span><br><span class="line">    <span class="keyword">if</span> keyboard_input.<span class="title function_ invoke__">pressed</span>(KeyCode::KeyA) &#123;</span><br><span class="line">        info!(<span class="string">&quot;&#x27;A&#x27; 键正在被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查按键是否刚刚被按下</span></span><br><span class="line">    <span class="keyword">if</span> keyboard_input.<span class="title function_ invoke__">just_pressed</span>(KeyCode::KeyA) &#123;</span><br><span class="line">        info!(<span class="string">&quot;&#x27;A&#x27; 键刚刚被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查按键是否刚刚被释放</span></span><br><span class="line">    <span class="keyword">if</span> keyboard_input.<span class="title function_ invoke__">just_released</span>(KeyCode::KeyA) &#123;</span><br><span class="line">        info!(<span class="string">&quot;&#x27;A&#x27; 键刚刚被释放&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>使用 <code>Res&lt;ButtonInput&lt;KeyCode&gt;&gt;</code> 获取键盘输入状态</li>
<li><code>pressed()</code> 检查按键是否正在被按下</li>
<li><code>just_pressed()</code> 检查按键是否刚刚被按下（只在按下瞬间触发一次）</li>
<li><code>just_released()</code> 检查按键是否刚刚被释放</li>
</ul>
<h3 id="键盘事件监听"><a href="#键盘事件监听" class="headerlink" title="键盘事件监听"></a>键盘事件监听</h3><p><strong>示例文件</strong>: <code>keyboard_input_events.rs</code></p>
<p>监听所有键盘事件：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;input::keyboard::KeyboardInput, prelude::*&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, print_keyboard_event_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 打印所有键盘事件的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_keyboard_event_system</span>(<span class="keyword">mut</span> keyboard_input_events: EventReader&lt;KeyboardInput&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> keyboard_input_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;键盘事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>使用 <code>EventReader&lt;KeyboardInput&gt;</code> 监听键盘事件</li>
<li>事件包含按键状态、物理键、逻辑键等信息</li>
<li>适合需要详细键盘信息的场景</li>
</ul>
<h3 id="键盘修饰键"><a href="#键盘修饰键" class="headerlink" title="键盘修饰键"></a>键盘修饰键</h3><p><strong>示例文件</strong>: <code>keyboard_modifiers.rs</code></p>
<p>处理组合键和修饰键：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, keyboard_input_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 处理组合键的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">keyboard_input_system</span>(input: Res&lt;ButtonInput&lt;KeyCode&gt;&gt;) &#123;</span><br><span class="line">    <span class="comment">// 检查Shift键是否被按下（左Shift或右Shift）</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">shift</span> = input.<span class="title function_ invoke__">any_pressed</span>([KeyCode::ShiftLeft, KeyCode::ShiftRight]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查Ctrl键是否被按下（左Ctrl或右Ctrl）</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ctrl</span> = input.<span class="title function_ invoke__">any_pressed</span>([KeyCode::ControlLeft, KeyCode::ControlRight]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查组合键 Ctrl + Shift + A</span></span><br><span class="line">    <span class="keyword">if</span> ctrl &amp;&amp; shift &amp;&amp; input.<span class="title function_ invoke__">just_pressed</span>(KeyCode::KeyA) &#123;</span><br><span class="line">        info!(<span class="string">&quot;刚刚按下了 Ctrl + Shift + A!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查其他组合键</span></span><br><span class="line">    <span class="keyword">if</span> ctrl &amp;&amp; input.<span class="title function_ invoke__">just_pressed</span>(KeyCode::KeyS) &#123;</span><br><span class="line">        info!(<span class="string">&quot;保存快捷键被触发&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ctrl &amp;&amp; input.<span class="title function_ invoke__">just_pressed</span>(KeyCode::KeyZ) &#123;</span><br><span class="line">        info!(<span class="string">&quot;撤销快捷键被触发&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>any_pressed()</code> 检查多个按键中是否有任意一个被按下</li>
<li>支持左右修饰键的检测</li>
<li>适合实现快捷键和组合键功能</li>
</ul>
<h3 id="字符输入"><a href="#字符输入" class="headerlink" title="字符输入"></a>字符输入</h3><p><strong>示例文件</strong>: <code>char_input_events.rs</code></p>
<p>处理字符输入（支持多语言）：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;</span><br><span class="line">    input::keyboard::&#123;Key, KeyboardInput&#125;,</span><br><span class="line">    prelude::*,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, print_char_event_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 处理字符输入的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_char_event_system</span>(<span class="keyword">mut</span> char_input_events: EventReader&lt;KeyboardInput&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> char_input_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        <span class="comment">// 只处理按键按下事件</span></span><br><span class="line">        <span class="keyword">if</span> !event.state.<span class="title function_ invoke__">is_pressed</span>() &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查是否为字符输入</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Key</span>::<span class="title function_ invoke__">Character</span>(character) = &amp;event.logical_key &#123;</span><br><span class="line">            info!(<span class="string">&quot;输入字符: &#x27;&#123;&#125;&#x27;&quot;</span>, character);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>使用 <code>event.logical_key</code> 获取逻辑键值</li>
<li><code>Key::Character</code> 表示字符输入</li>
<li>支持多语言字符输入</li>
<li>适合文本输入和聊天功能</li>
</ul>
<hr>
<h2 id="鼠标输入"><a href="#鼠标输入" class="headerlink" title="鼠标输入"></a>鼠标输入</h2><h3 id="基础鼠标输入"><a href="#基础鼠标输入" class="headerlink" title="基础鼠标输入"></a>基础鼠标输入</h3><p><strong>示例文件</strong>: <code>mouse_input.rs</code></p>
<p>处理鼠标按钮和移动：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;</span><br><span class="line">    input::mouse::&#123;AccumulatedMouseMotion, AccumulatedMouseScroll&#125;,</span><br><span class="line">    prelude::*,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, (mouse_click_system, mouse_move_system))</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 处理鼠标点击的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">mouse_click_system</span>(mouse_button_input: Res&lt;ButtonInput&lt;MouseButton&gt;&gt;) &#123;</span><br><span class="line">    <span class="comment">// 检查左键是否正在被按下</span></span><br><span class="line">    <span class="keyword">if</span> mouse_button_input.<span class="title function_ invoke__">pressed</span>(MouseButton::Left) &#123;</span><br><span class="line">        info!(<span class="string">&quot;左键正在被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查左键是否刚刚被按下</span></span><br><span class="line">    <span class="keyword">if</span> mouse_button_input.<span class="title function_ invoke__">just_pressed</span>(MouseButton::Left) &#123;</span><br><span class="line">        info!(<span class="string">&quot;左键刚刚被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查左键是否刚刚被释放</span></span><br><span class="line">    <span class="keyword">if</span> mouse_button_input.<span class="title function_ invoke__">just_released</span>(MouseButton::Left) &#123;</span><br><span class="line">        info!(<span class="string">&quot;左键刚刚被释放&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查右键</span></span><br><span class="line">    <span class="keyword">if</span> mouse_button_input.<span class="title function_ invoke__">just_pressed</span>(MouseButton::Right) &#123;</span><br><span class="line">        info!(<span class="string">&quot;右键刚刚被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查中键</span></span><br><span class="line">    <span class="keyword">if</span> mouse_button_input.<span class="title function_ invoke__">just_pressed</span>(MouseButton::Middle) &#123;</span><br><span class="line">        info!(<span class="string">&quot;中键刚刚被按下&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 处理鼠标移动和滚轮的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">mouse_move_system</span>(</span><br><span class="line">    accumulated_mouse_motion: Res&lt;AccumulatedMouseMotion&gt;,</span><br><span class="line">    accumulated_mouse_scroll: Res&lt;AccumulatedMouseScroll&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 处理鼠标移动</span></span><br><span class="line">    <span class="keyword">if</span> accumulated_mouse_motion.delta != Vec2::ZERO &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">delta</span> = accumulated_mouse_motion.delta;</span><br><span class="line">        info!(<span class="string">&quot;鼠标移动了 (&#123;&#125;, &#123;&#125;)&quot;</span>, delta.x, delta.y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理鼠标滚轮</span></span><br><span class="line">    <span class="keyword">if</span> accumulated_mouse_scroll.delta != Vec2::ZERO &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">delta</span> = accumulated_mouse_scroll.delta;</span><br><span class="line">        info!(<span class="string">&quot;鼠标滚动了 (&#123;&#125;, &#123;&#125;)&quot;</span>, delta.x, delta.y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>ButtonInput&lt;MouseButton&gt;</code> 处理鼠标按钮</li>
<li><code>AccumulatedMouseMotion</code> 处理鼠标移动</li>
<li><code>AccumulatedMouseScroll</code> 处理滚轮滚动</li>
<li>支持左键、右键、中键检测</li>
</ul>
<h3 id="鼠标事件监听"><a href="#鼠标事件监听" class="headerlink" title="鼠标事件监听"></a>鼠标事件监听</h3><p><strong>示例文件</strong>: <code>mouse_input_events.rs</code></p>
<p>监听详细的鼠标事件：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;</span><br><span class="line">    input::&#123;</span><br><span class="line">        gestures::*,</span><br><span class="line">        mouse::&#123;MouseButtonInput, MouseMotion, MouseWheel&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    prelude::*,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, print_mouse_events_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 打印所有鼠标事件的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_mouse_events_system</span>(</span><br><span class="line">    <span class="keyword">mut</span> mouse_button_input_events: EventReader&lt;MouseButtonInput&gt;,</span><br><span class="line">    <span class="keyword">mut</span> mouse_motion_events: EventReader&lt;MouseMotion&gt;,</span><br><span class="line">    <span class="keyword">mut</span> cursor_moved_events: EventReader&lt;CursorMoved&gt;,</span><br><span class="line">    <span class="keyword">mut</span> mouse_wheel_events: EventReader&lt;MouseWheel&gt;,</span><br><span class="line">    <span class="keyword">mut</span> pinch_gesture_events: EventReader&lt;PinchGesture&gt;,</span><br><span class="line">    <span class="keyword">mut</span> rotation_gesture_events: EventReader&lt;RotationGesture&gt;,</span><br><span class="line">    <span class="keyword">mut</span> double_tap_gesture_events: EventReader&lt;DoubleTapGesture&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 鼠标按钮事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> mouse_button_input_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;鼠标按钮事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 鼠标移动事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> mouse_motion_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;鼠标移动事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 光标移动事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> cursor_moved_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;光标移动事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 鼠标滚轮事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> mouse_wheel_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;鼠标滚轮事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 手势事件（仅macOS）</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> pinch_gesture_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;捏合手势事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> rotation_gesture_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;旋转手势事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> double_tap_gesture_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;双击手势事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>多种事件类型提供不同粒度的鼠标信息</li>
<li>手势事件仅在macOS上可用</li>
<li>适合需要精确鼠标控制的场景</li>
</ul>
<h3 id="鼠标光标控制"><a href="#鼠标光标控制" class="headerlink" title="鼠标光标控制"></a>鼠标光标控制</h3><p><strong>示例文件</strong>: <code>mouse_grab.rs</code></p>
<p>控制鼠标光标的显示和锁定：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;prelude::*, window::CursorGrabMode&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, grab_mouse)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 控制鼠标光标抓取的系统</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">grab_mouse</span>(</span><br><span class="line">    <span class="keyword">mut</span> window: Single&lt;&amp;<span class="keyword">mut</span> Window&gt;,</span><br><span class="line">    mouse: Res&lt;ButtonInput&lt;MouseButton&gt;&gt;,</span><br><span class="line">    key: Res&lt;ButtonInput&lt;KeyCode&gt;&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 左键点击时隐藏光标并锁定鼠标</span></span><br><span class="line">    <span class="keyword">if</span> mouse.<span class="title function_ invoke__">just_pressed</span>(MouseButton::Left) &#123;</span><br><span class="line">        window.cursor_options.visible = <span class="literal">false</span>;</span><br><span class="line">        window.cursor_options.grab_mode = CursorGrabMode::Locked;</span><br><span class="line">        info!(<span class="string">&quot;鼠标已锁定&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ESC键释放鼠标</span></span><br><span class="line">    <span class="keyword">if</span> key.<span class="title function_ invoke__">just_pressed</span>(KeyCode::Escape) &#123;</span><br><span class="line">        window.cursor_options.visible = <span class="literal">true</span>;</span><br><span class="line">        window.cursor_options.grab_mode = CursorGrabMode::<span class="literal">None</span>;</span><br><span class="line">        info!(<span class="string">&quot;鼠标已释放&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他光标模式示例</span></span><br><span class="line">    <span class="keyword">if</span> key.<span class="title function_ invoke__">just_pressed</span>(KeyCode::Key1) &#123;</span><br><span class="line">        <span class="comment">// 限制光标在窗口内</span></span><br><span class="line">        window.cursor_options.grab_mode = CursorGrabMode::Confined;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> key.<span class="title function_ invoke__">just_pressed</span>(KeyCode::Key2) &#123;</span><br><span class="line">        <span class="comment">// 隐藏光标但不锁定</span></span><br><span class="line">        window.cursor_options.visible = <span class="literal">false</span>;</span><br><span class="line">        window.cursor_options.grab_mode = CursorGrabMode::<span class="literal">None</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>CursorGrabMode::Locked</code> 锁定鼠标到窗口中心</li>
<li><code>CursorGrabMode::Confined</code> 限制鼠标在窗口内</li>
<li><code>CursorGrabMode::None</code> 正常模式</li>
<li>适合FPS游戏等需要鼠标控制的场景</li>
</ul>
<hr>
<h2 id="触摸输入"><a href="#触摸输入" class="headerlink" title="触摸输入"></a>触摸输入</h2><h3 id="基础触摸输入"><a href="#基础触摸输入" class="headerlink" title="基础触摸输入"></a>基础触摸输入</h3><p><strong>示例文件</strong>: <code>touch_input.rs</code></p>
<p>处理触摸屏输入：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;input::touch::*, prelude::*&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, touch_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">touch_system</span>(touches: Res&lt;Touches&gt;) &#123;</span><br><span class="line">    <span class="comment">// 处理刚刚按下的触摸</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">touch</span> <span class="keyword">in</span> touches.<span class="title function_ invoke__">iter_just_pressed</span>() &#123;</span><br><span class="line">        info!(</span><br><span class="line">            <span class="string">&quot;触摸按下 - ID: &#123;&#125;, 位置: &#123;&#125;&quot;</span>,</span><br><span class="line">            touch.<span class="title function_ invoke__">id</span>(),</span><br><span class="line">            touch.<span class="title function_ invoke__">position</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理刚刚释放的触摸</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">touch</span> <span class="keyword">in</span> touches.<span class="title function_ invoke__">iter_just_released</span>() &#123;</span><br><span class="line">        info!(</span><br><span class="line">            <span class="string">&quot;触摸释放 - ID: &#123;&#125;, 位置: &#123;&#125;&quot;</span>,</span><br><span class="line">            touch.<span class="title function_ invoke__">id</span>(),</span><br><span class="line">            touch.<span class="title function_ invoke__">position</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理被取消的触摸</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">touch</span> <span class="keyword">in</span> touches.<span class="title function_ invoke__">iter_just_canceled</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;触摸取消 - ID: &#123;&#125;&quot;</span>, touch.<span class="title function_ invoke__">id</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理所有当前活动的触摸</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">touch</span> <span class="keyword">in</span> touches.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;活动触摸: &#123;touch:?&#125;&quot;</span>);</span><br><span class="line">        info!(<span class="string">&quot;  是否刚刚按下: &#123;&#125;&quot;</span>, touches.<span class="title function_ invoke__">just_pressed</span>(touch.<span class="title function_ invoke__">id</span>()));</span><br><span class="line">        info!(<span class="string">&quot;  是否正在按下: &#123;&#125;&quot;</span>, touches.<span class="title function_ invoke__">pressed</span>(touch.<span class="title function_ invoke__">id</span>()));</span><br><span class="line">        info!(<span class="string">&quot;  位置: &#123;&#125;&quot;</span>, touch.<span class="title function_ invoke__">position</span>());</span><br><span class="line">        info!(<span class="string">&quot;  压力: &#123;&#125;&quot;</span>, touch.force().<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0.0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取触摸数量</span></span><br><span class="line">    info!(<span class="string">&quot;当前触摸数量: &#123;&#125;&quot;</span>, touches.<span class="title function_ invoke__">count</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>Touches</code> 资源提供触摸状态</li>
<li>每个触摸有唯一ID</li>
<li>支持多点触摸</li>
<li>包含位置和压力信息</li>
</ul>
<h3 id="触摸事件监听"><a href="#触摸事件监听" class="headerlink" title="触摸事件监听"></a>触摸事件监听</h3><p><strong>示例文件</strong>: <code>touch_input_events.rs</code></p>
<p>监听详细的触摸事件：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;input::touch::*, prelude::*&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, touch_event_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">touch_event_system</span>(<span class="keyword">mut</span> touch_events: EventReader&lt;TouchInput&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> touch_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;触摸事件: &#123;:?&#125;&quot;</span>, event);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> event.phase &#123;</span><br><span class="line">            TouchPhase::Started =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;触摸开始 - ID: &#123;&#125;, 位置: &#123;&#125;&quot;</span>, event.id, event.position);</span><br><span class="line">            &#125;</span><br><span class="line">            TouchPhase::Moved =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;触摸移动 - ID: &#123;&#125;, 位置: &#123;&#125;&quot;</span>, event.id, event.position);</span><br><span class="line">            &#125;</span><br><span class="line">            TouchPhase::Ended =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;触摸结束 - ID: &#123;&#125;, 位置: &#123;&#125;&quot;</span>, event.id, event.position);</span><br><span class="line">            &#125;</span><br><span class="line">            TouchPhase::Canceled =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;触摸取消 - ID: &#123;&#125;&quot;</span>, event.id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>TouchInput</code> 事件提供详细的触摸信息</li>
<li><code>TouchPhase</code> 表示触摸的不同阶段</li>
<li>适合需要精确触摸控制的场景</li>
</ul>
<hr>
<h2 id="游戏手柄输入"><a href="#游戏手柄输入" class="headerlink" title="游戏手柄输入"></a>游戏手柄输入</h2><h3 id="基础游戏手柄输入"><a href="#基础游戏手柄输入" class="headerlink" title="基础游戏手柄输入"></a>基础游戏手柄输入</h3><p><strong>示例文件</strong>: <code>gamepad_input.rs</code></p>
<p>处理游戏手柄输入：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, gamepad_system)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">gamepad_system</span>(gamepads: Query&lt;(Entity, &amp;Gamepad)&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (entity, gamepad) <span class="keyword">in</span> &amp;gamepads &#123;</span><br><span class="line">        <span class="comment">// 处理按钮输入</span></span><br><span class="line">        <span class="keyword">if</span> gamepad.<span class="title function_ invoke__">just_pressed</span>(GamepadButton::South) &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 刚刚按下 South 按钮&quot;</span>, entity);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> gamepad.<span class="title function_ invoke__">just_released</span>(GamepadButton::South) &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 刚刚释放 South 按钮&quot;</span>, entity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理扳机键（模拟输入）</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">right_trigger</span> = gamepad.<span class="title function_ invoke__">get</span>(GamepadButton::RightTrigger2).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">if</span> right_trigger.<span class="title function_ invoke__">abs</span>() &gt; <span class="number">0.01</span> &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 右扳机值: &#123;&#125;&quot;</span>, entity, right_trigger);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理摇杆输入</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">left_stick_x</span> = gamepad.<span class="title function_ invoke__">get</span>(GamepadAxis::LeftStickX).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">left_stick_y</span> = gamepad.<span class="title function_ invoke__">get</span>(GamepadAxis::LeftStickY).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">if</span> left_stick_x.<span class="title function_ invoke__">abs</span>() &gt; <span class="number">0.01</span> || left_stick_y.<span class="title function_ invoke__">abs</span>() &gt; <span class="number">0.01</span> &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 左摇杆: (&#123;&#125;, &#123;&#125;)&quot;</span>, entity, left_stick_x, left_stick_y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">right_stick_x</span> = gamepad.<span class="title function_ invoke__">get</span>(GamepadAxis::RightStickX).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">right_stick_y</span> = gamepad.<span class="title function_ invoke__">get</span>(GamepadAxis::RightStickY).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">if</span> right_stick_x.<span class="title function_ invoke__">abs</span>() &gt; <span class="number">0.01</span> || right_stick_y.<span class="title function_ invoke__">abs</span>() &gt; <span class="number">0.01</span> &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 右摇杆: (&#123;&#125;, &#123;&#125;)&quot;</span>, entity, right_stick_x, right_stick_y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理其他按钮</span></span><br><span class="line">        <span class="keyword">if</span> gamepad.<span class="title function_ invoke__">just_pressed</span>(GamepadButton::North) &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 按下 North 按钮&quot;</span>, entity);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> gamepad.<span class="title function_ invoke__">just_pressed</span>(GamepadButton::East) &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 按下 East 按钮&quot;</span>, entity);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> gamepad.<span class="title function_ invoke__">just_pressed</span>(GamepadButton::West) &#123;</span><br><span class="line">            info!(<span class="string">&quot;手柄 &#123;&#125; 按下 West 按钮&quot;</span>, entity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li><code>Gamepad</code> 组件提供手柄输入状态</li>
<li>支持多个手柄同时连接</li>
<li>按钮有数字和模拟两种输入</li>
<li>摇杆提供X、Y轴模拟输入</li>
</ul>
<h3 id="游戏手柄事件监听"><a href="#游戏手柄事件监听" class="headerlink" title="游戏手柄事件监听"></a>游戏手柄事件监听</h3><p><strong>示例文件</strong>: <code>gamepad_input_events.rs</code></p>
<p>监听游戏手柄连接和输入事件：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> bevy::&#123;</span><br><span class="line">    input::gamepad::&#123;</span><br><span class="line">        GamepadAxisChangedEvent, GamepadButtonChangedEvent, GamepadButtonStateChangedEvent,</span><br><span class="line">        GamepadConnectionEvent, GamepadEvent,</span><br><span class="line">    &#125;,</span><br><span class="line">    prelude::*,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Update, (gamepad_events, gamepad_ordered_events))</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">gamepad_events</span>(</span><br><span class="line">    <span class="keyword">mut</span> connection_events: EventReader&lt;GamepadConnectionEvent&gt;,</span><br><span class="line">    <span class="keyword">mut</span> axis_changed_events: EventReader&lt;GamepadAxisChangedEvent&gt;,</span><br><span class="line">    <span class="keyword">mut</span> button_changed_events: EventReader&lt;GamepadButtonChangedEvent&gt;,</span><br><span class="line">    <span class="keyword">mut</span> button_input_events: EventReader&lt;GamepadButtonStateChangedEvent&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 处理连接事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">connection_event</span> <span class="keyword">in</span> connection_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;手柄连接事件: &#123;:?&#125;&quot;</span>, connection_event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理轴变化事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">axis_changed_event</span> <span class="keyword">in</span> axis_changed_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(</span><br><span class="line">            <span class="string">&quot;手柄轴变化 - 轴: &#123;:?&#125;, 手柄: &#123;&#125;, 值: &#123;&#125;&quot;</span>,</span><br><span class="line">            axis_changed_event.axis, axis_changed_event.entity, axis_changed_event.value</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理按钮变化事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">button_changed_event</span> <span class="keyword">in</span> button_changed_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(</span><br><span class="line">            <span class="string">&quot;手柄按钮变化 - 按钮: &#123;:?&#125;, 手柄: &#123;&#125;, 值: &#123;&#125;&quot;</span>,</span><br><span class="line">            button_changed_event.button, button_changed_event.entity, button_changed_event.value</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理按钮状态变化事件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">button_input_event</span> <span class="keyword">in</span> button_input_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        info!(<span class="string">&quot;手柄按钮状态变化: &#123;:?&#125;&quot;</span>, button_input_event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理有序的游戏手柄事件</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">gamepad_ordered_events</span>(<span class="keyword">mut</span> gamepad_events: EventReader&lt;GamepadEvent&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">gamepad_event</span> <span class="keyword">in</span> gamepad_events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        <span class="keyword">match</span> gamepad_event &#123;</span><br><span class="line">            GamepadEvent::<span class="title function_ invoke__">Connection</span>(connection_event) =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;手柄连接事件: &#123;:?&#125;&quot;</span>, connection_event);</span><br><span class="line">            &#125;</span><br><span class="line">            GamepadEvent::<span class="title function_ invoke__">Button</span>(button_event) =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;手柄按钮事件: &#123;:?&#125;&quot;</span>, button_event);</span><br><span class="line">            &#125;</span><br><span class="line">            GamepadEvent::<span class="title function_ invoke__">Axis</span>(axis_event) =&gt; &#123;</span><br><span class="line">                info!(<span class="string">&quot;手柄轴事件: &#123;:?&#125;&quot;</span>, axis_event);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>多种事件类型提供不同粒度的手柄信息</li>
<li>连接事件处理手柄插拔</li>
<li>轴和按钮事件提供精确的输入变化</li>
<li>有序事件确保事件处理的正确顺序</li>
</ul>
<hr>
<h2 id="文本输入"><a href="#文本输入" class="headerlink" title="文本输入"></a>文本输入</h2><h3 id="基础文本输入"><a href="#基础文本输入" class="headerlink" title="基础文本输入"></a>基础文本输入</h3><p><strong>示例文件</strong>: <code>text_input.rs</code></p>
<p>处理文本输入和IME（输入法编辑器）：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::mem;</span><br><span class="line"><span class="keyword">use</span> bevy::&#123;</span><br><span class="line">    input::keyboard::&#123;Key, KeyboardInput&#125;,</span><br><span class="line">    prelude::*,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">add_plugins</span>(DefaultPlugins)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(Startup, setup_scene)</span><br><span class="line">        .<span class="title function_ invoke__">add_systems</span>(</span><br><span class="line">            Update,</span><br><span class="line">            (</span><br><span class="line">                toggle_ime,</span><br><span class="line">                listen_ime_events,</span><br><span class="line">                listen_keyboard_input_events,</span><br><span class="line">                bubbling_text,</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">        .<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">setup_scene</span>(<span class="keyword">mut</span> commands: Commands, asset_server: Res&lt;AssetServer&gt;) &#123;</span><br><span class="line">    commands.<span class="title function_ invoke__">spawn</span>(Camera2d);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用支持更多字符的字体</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">font</span> = asset_server.<span class="title function_ invoke__">load</span>(<span class="string">&quot;fonts/FiraMono-Medium.ttf&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建UI文本显示</span></span><br><span class="line">    commands.<span class="title function_ invoke__">spawn</span>((</span><br><span class="line">        Text::<span class="title function_ invoke__">default</span>(),</span><br><span class="line">        Node &#123;</span><br><span class="line">            position_type: PositionType::Absolute,</span><br><span class="line">            top: Val::<span class="title function_ invoke__">Px</span>(<span class="number">12.0</span>),</span><br><span class="line">            left: Val::<span class="title function_ invoke__">Px</span>(<span class="number">12.0</span>),</span><br><span class="line">            ..<span class="title function_ invoke__">default</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        children![</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;点击切换IME。按回车开始新行。\\n\\n&quot;</span>),</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;IME启用: &quot;</span>),</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;false\\n&quot;</span>),</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;IME激活: &quot;</span>),</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;false\\n&quot;</span>),</span><br><span class="line">            TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;IME缓冲区: &quot;</span>),</span><br><span class="line">            (</span><br><span class="line">                TextSpan::<span class="title function_ invoke__">new</span>(<span class="string">&quot;\\n&quot;</span>),</span><br><span class="line">                TextFont &#123;</span><br><span class="line">                    font: font.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">                    ..<span class="title function_ invoke__">default</span>()</span><br><span class="line">                &#125;,</span><br><span class="line">            ),</span><br><span class="line">        ],</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建2D文本用于输入</span></span><br><span class="line">    commands.<span class="title function_ invoke__">spawn</span>((</span><br><span class="line">        Text2d::<span class="title function_ invoke__">new</span>(<span class="string">&quot;&quot;</span>),</span><br><span class="line">        TextFont &#123;</span><br><span class="line">            font,</span><br><span class="line">            font_size: <span class="number">100.0</span>,</span><br><span class="line">            ..<span class="title function_ invoke__">default</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换IME状态</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">toggle_ime</span>(</span><br><span class="line">    input: Res&lt;ButtonInput&lt;MouseButton&gt;&gt;,</span><br><span class="line">    <span class="keyword">mut</span> window: Single&lt;&amp;<span class="keyword">mut</span> Window&gt;,</span><br><span class="line">    status_text: Single&lt;Entity, (With&lt;Node&gt;, With&lt;Text&gt;)&gt;,</span><br><span class="line">    <span class="keyword">mut</span> ui_writer: TextUiWriter,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">if</span> input.<span class="title function_ invoke__">just_pressed</span>(MouseButton::Left) &#123;</span><br><span class="line">        window.ime_position = window.<span class="title function_ invoke__">cursor_position</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        window.ime_enabled = !window.ime_enabled;</span><br><span class="line"></span><br><span class="line">        *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">3</span>) = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;\\n&quot;</span>, window.ime_enabled);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听IME事件</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">listen_ime_events</span>(</span><br><span class="line">    <span class="keyword">mut</span> events: EventReader&lt;Ime&gt;,</span><br><span class="line">    status_text: Single&lt;Entity, (With&lt;Node&gt;, With&lt;Text&gt;)&gt;,</span><br><span class="line">    <span class="keyword">mut</span> edit_text: Single&lt;&amp;<span class="keyword">mut</span> Text2d, (Without&lt;Node&gt;, Without&lt;Bubble&gt;)&gt;,</span><br><span class="line">    <span class="keyword">mut</span> ui_writer: TextUiWriter,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        <span class="keyword">match</span> event &#123;</span><br><span class="line">            Ime::Preedit &#123; value, cursor &#125; =&gt; &#123;</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">5</span>) = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;\\n&quot;</span>, value);</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">4</span>) = <span class="string">&quot;true\\n&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            Ime::Commit &#123; value &#125; =&gt; &#123;</span><br><span class="line">                edit_text.<span class="number">0</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>, edit_text.<span class="number">0</span>, value);</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">5</span>) = <span class="string">&quot;\\n&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">4</span>) = <span class="string">&quot;false\\n&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            Ime::Enabled &#123; .. &#125; =&gt; &#123;</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">4</span>) = <span class="string">&quot;true\\n&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            Ime::Disabled &#123; .. &#125; =&gt; &#123;</span><br><span class="line">                *ui_writer.<span class="title function_ invoke__">text</span>(*status_text, <span class="number">4</span>) = <span class="string">&quot;false\\n&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听键盘输入事件</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">listen_keyboard_input_events</span>(</span><br><span class="line">    <span class="keyword">mut</span> commands: Commands,</span><br><span class="line">    <span class="keyword">mut</span> events: EventReader&lt;KeyboardInput&gt;,</span><br><span class="line">    edit_text: Single&lt;(&amp;<span class="keyword">mut</span> Text2d, &amp;TextFont), (Without&lt;Node&gt;, Without&lt;Bubble&gt;)&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">event</span> <span class="keyword">in</span> events.<span class="title function_ invoke__">read</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> !event.state.<span class="title function_ invoke__">is_pressed</span>() &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> &amp;event.logical_key &#123;</span><br><span class="line">            Key::<span class="title function_ invoke__">Character</span>(character) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="title function_ invoke__">is_printable_char</span>(*character) &#123;</span><br><span class="line">                    edit_text.<span class="number">0</span> .<span class="number">0</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>, edit_text.<span class="number">0</span> .<span class="number">0</span>, character);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Key::Enter =&gt; &#123;</span><br><span class="line">                edit_text.<span class="number">0</span> .<span class="number">0</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;\\n&quot;</span>, edit_text.<span class="number">0</span> .<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Key::Backspace =&gt; &#123;</span><br><span class="line">                edit_text.<span class="number">0</span> .<span class="number">0</span>.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            _ =&gt; &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否为可打印字符</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">is_printable_char</span>(chr: <span class="type">char</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    !chr.<span class="title function_ invoke__">is_control</span>() || chr == <span class="string">&#x27;\<span class="char escape_">\n</span>&#x27;</span> || chr == <span class="string">&#x27;\<span class="char escape_">\t</span>&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关键要点</strong>:</p>
<ul>
<li>IME支持多语言输入</li>
<li>处理预编辑和提交事件</li>
<li>支持特殊键如回车、退格</li>
<li>需要合适的字体支持多语言字符</li>
</ul>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Bevy的输入系统提供了全面的输入处理能力：</p>
<ol>
<li><strong>键盘输入</strong>: 基础按键、组合键、字符输入</li>
<li><strong>鼠标输入</strong>: 按钮、移动、滚轮、光标控制</li>
<li><strong>触摸输入</strong>: 多点触摸、手势识别</li>
<li><strong>游戏手柄</strong>: 按钮、摇杆、扳机、震动</li>
<li><strong>文本输入</strong>: IME支持、多语言输入</li>
</ol>
<p>这些输入系统可以组合使用，创建丰富的交互体验。建议根据项目需求选择合适的输入方式。</p>
</article>
<div class="article-footer">

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">回顾上一篇</div><a href="/Luo-Haomin/wiki/BevyBook/Input/README/">Input（输入处理）</a></div><div class="item" id="next"><div class="note">接下来阅读</div><a href="/Luo-Haomin/wiki/BevyBook/Input/%E8%BE%93%E5%85%A5%E5%A4%84%E7%90%86/">输入处理</a></div></section></div>




<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">LuoHaomin</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1">Stellar 1.33.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#input%E5%9F%BA%E7%A1%80"><span class="toc-text">input基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bevy-Input-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B"><span class="toc-text">Bevy Input 基础教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5"><span class="toc-text">键盘输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5"><span class="toc-text">基础键盘输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">键盘事件监听</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E4%BF%AE%E9%A5%B0%E9%94%AE"><span class="toc-text">键盘修饰键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E8%BE%93%E5%85%A5"><span class="toc-text">字符输入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E8%BE%93%E5%85%A5"><span class="toc-text">鼠标输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%BC%A0%E6%A0%87%E8%BE%93%E5%85%A5"><span class="toc-text">基础鼠标输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">鼠标事件监听</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E5%85%89%E6%A0%87%E6%8E%A7%E5%88%B6"><span class="toc-text">鼠标光标控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E6%91%B8%E8%BE%93%E5%85%A5"><span class="toc-text">触摸输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%A7%A6%E6%91%B8%E8%BE%93%E5%85%A5"><span class="toc-text">基础触摸输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">触摸事件监听</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E6%89%8B%E6%9F%84%E8%BE%93%E5%85%A5"><span class="toc-text">游戏手柄输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%B8%B8%E6%88%8F%E6%89%8B%E6%9F%84%E8%BE%93%E5%85%A5"><span class="toc-text">基础游戏手柄输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E6%89%8B%E6%9F%84%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">游戏手柄事件监听</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E8%BE%93%E5%85%A5"><span class="toc-text">文本输入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%96%87%E6%9C%AC%E8%BE%93%E5%85%A5"><span class="toc-text">基础文本输入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>回到顶部</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"originalHost":null,"officialHosts":["localhost"],"encoded":""};
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/Luo-Haomin/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/Luo-Haomin/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] 超时:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('请求超时');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('响应失败');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] 错误:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
    // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode 当前模式 dark or light
  // utils.dark.toggle() 暗黑模式触发器
  // utils.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // 通知 LazyLoad 更新
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/Luo-Haomin/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: 这会导致无法使用 preferred_color_scheme 以外的主题
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
